<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover,user-scalable=no"><title>HypeZone Elite</title><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Courgette&display=swap" rel="stylesheet"><style>:root{--bg:#000;--card:#111;--primary:#00d2ff;--text:#fff;--muted:#888;--border:rgba(255,255,255,0.12);--viby:#ffd700;--danger:#ff4757;--success:#2ecc71;--orange:#ff7a21}*{box-sizing:border-box;margin:0;padding:0;outline:0;-webkit-tap-highlight-color:transparent;font-family:'Outfit',sans-serif}body{background:var(--bg);color:var(--text);height:100vh;overflow:hidden}.hidden{display:none!important}svg{display:block;width:24px;height:24px;fill:none;stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round}.authPage{height:100svh;min-height:100svh;display:flex;flex-direction:column;background:#f5e6d3;z-index:4000;position:fixed;inset:0;overflow:hidden;color:#1a1a1a;padding-bottom:calc(env(safe-area-inset-bottom,0px) + 70px)}.hero{width:100%;height:clamp(240px,46svh,420px);padding:10px 14px 0}.hero img{width:100%;height:100%;object-fit:cover;border-radius:0 0 50px 50px}.content{padding:18px 22px 0;text-align:left;display:flex;flex-direction:column;gap:12px;flex:1;justify-content:flex-start}.typing-container{min-height:64px}h1.dynamic-title{font-size:32px;font-weight:800;color:#050505;line-height:1.1;margin-bottom:5px}.cursor{display:inline-block;width:3px;background-color:var(--orange);margin-left:2px;animation:blink .7s infinite}.sub-text{font-size:15px;color:#666;font-weight:400;line-height:1.5;max-width:100%}.google-btn{background:var(--orange);color:#fff;border:none;padding:18px;border-radius:40px;font-weight:700;font-size:16px;display:flex;align-items:center;justify-content:center;gap:12px;cursor:pointer;margin-top:14px;box-shadow:0 10px 20px rgba(255,122,33,.3)}.google-btn img{width:22px;height:22px;background:#fff;border-radius:50%;padding:2px}.tiktok-link{position:fixed;left:0;right:0;bottom:calc(env(safe-area-inset-bottom,0px) + 14px);margin:0 auto;display:flex;align-items:center;justify-content:center;gap:8px;text-decoration:none;color:#1a1a1a;font-weight:700;font-size:14px;width:fit-content;padding:10px 14px;border-radius:999px;background:rgba(255,255,255,.75);backdrop-filter:blur(10px);border:1px solid rgba(0,0,0,.08)}@keyframes blink{0%,100%{opacity:1}50%{opacity:0}}#mainScroll{height:100vh;overflow-y:auto;padding-bottom:100px;position:relative}.topbar{padding:15px 20px;display:flex;justify-content:space-between;align-items:center;background:0 0;z-index:50}.brand{font-family:'Courgette',cursive;font-size:26px;color:var(--primary);text-shadow:0 0 15px rgba(0,210,255,.4)}.user-badge{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,.1);padding:5px 12px;border-radius:30px;border:1px solid var(--border);cursor:pointer}.user-badge img{width:28px;height:28px;border-radius:50%;border:1px solid var(--primary);object-fit:cover}.vibe-score{font-size:13px;font-weight:800;color:var(--viby);display:flex;align-items:center;gap:4px}.event-banner{padding:0 15px;margin-bottom:20px}.event-banner img{width:100%;height:90px;object-fit:cover;border-radius:20px;border:1px solid var(--border);box-shadow:0 5px 20px rgba(0,0,0,.5);display:block}.feed{padding:0 15px 15px 15px;display:flex;flex-direction:column;gap:25px}.post-card{background:var(--card);border-radius:24px;border:1px solid var(--border);overflow:hidden;position:relative}.post-header{padding:12px 15px;display:flex;align-items:center;justify-content:space-between;background:rgba(0,0,0,.2)}.post-user-info{display:flex;align-items:center;gap:10px}.p-avatar{width:42px;height:42px;border-radius:50%;border:2px solid #333;object-fit:cover;cursor:pointer}.p-name{font-size:14px;font-weight:700;color:#fff;cursor:pointer;display:flex;align-items:center;gap:6px}.rank-tag{font-size:9px;font-weight:900;padding:2px 6px;border-radius:4px;text-transform:uppercase;color:#000;letter-spacing:.5px}.rank-rookie{background:#a0a0a0}.rank-gold{background:linear-gradient(45deg,#ffd700,#fff)}.rank-legend{background:linear-gradient(45deg,#00d2ff,#fff)}.p-loc{font-size:11px;color:var(--muted)}.delete-btn{background:0 0;border:none;color:var(--danger);cursor:pointer;padding:5px;display:flex;align-items:center}.post-visual{width:100%;min-height:350px;display:flex;align-items:center;justify-content:center;background:#000;position:relative}.post-visual img{width:100%;display:block;object-fit:cover}.bg-text{font-size:24px;font-weight:800;text-align:center;padding:20px;color:#fff;text-shadow:0 4px 15px rgba(0,0,0,.6)}.img-caption{position:absolute;bottom:0;left:0;width:100%;padding:60px 15px 15px;background:linear-gradient(to top,rgba(0,0,0,.9),transparent);color:#fff;font-size:15px;font-weight:500;pointer-events:none;z-index:10}.post-actions{padding:12px 15px;display:flex;justify-content:space-between;border-top:1px solid var(--border);background:#0a0a0a;align-items:center;z-index:20;position:relative}.vote-box{display:flex;align-items:center;background:#1a1a1a;border-radius:20px;padding:4px;gap:8px;border:1px solid var(--border)}.vote-btn{background:0 0;border:none;padding:6px 8px;color:#666;cursor:pointer;display:flex;align-items:center;transition:.2s}.vote-btn.up.active{color:var(--success)}.vote-btn.down.active{color:var(--danger)}.vote-val{font-size:14px;font-weight:800;min-width:20px;text-align:center;color:#fff}.action-btn{background:rgba(255,255,255,.05);border:1px solid var(--border);color:#fff;padding:8px 16px;border-radius:20px;font-size:12px;font-weight:600;display:flex;align-items:center;gap:6px;cursor:pointer}.rooms-layout{padding:0 20px 20px 20px}.city-header{display:flex;align-items:center;gap:10px;margin:25px 0 15px;border-bottom:1px solid var(--border);padding-bottom:10px}.city-icon{color:var(--primary);width:24px;height:24px}.city-title{font-size:22px;font-weight:900;color:#fff;text-transform:uppercase;letter-spacing:1px}.hood-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}.hood-item{background:linear-gradient(145deg,#1a1a1a,#111);border:1px solid var(--border);padding:20px;border-radius:16px;text-align:center;cursor:pointer;position:relative;overflow:hidden;transition:.2s}.hood-item:active{transform:scale(.96);border-color:var(--primary)}.hood-name{font-size:14px;font-weight:700;z-index:2;position:relative}.online-dot{width:8px;height:8px;background:#00ff9d;border-radius:50%;position:absolute;top:10px;right:10px;box-shadow:0 0 8px #00ff9d}.dock-wrapper{position:fixed;bottom:25px;left:0;right:0;display:flex;justify-content:center;pointer-events:none;z-index:100}.dock{pointer-events:auto;background:rgba(20,20,20,.95);backdrop-filter:blur(20px);border:1px solid var(--border);border-radius:40px;padding:10px 30px;display:flex;align-items:center;gap:35px;box-shadow:0 15px 50px rgba(0,0,0,.7)}.dock-btn{background:0 0;border:none;color:#666;display:flex;flex-direction:column;align-items:center;gap:4px;font-size:10px;font-weight:700;cursor:pointer;width:40px;transition:.2s}.dock-btn.active{color:var(--primary);transform:translateY(-3px)}.fab-main{pointer-events:auto;width:65px;height:65px;border-radius:50%;background:linear-gradient(135deg,#00d2ff,#007aff);box-shadow:0 10px 30px rgba(0,210,255,.3);display:grid;place-items:center;color:#fff;font-size:34px;border:none;cursor:pointer;margin:0 10px;transform:translateY(-30px);border:5px solid var(--bg);transition:transform .2s}.fab-main:active{transform:translateY(-30px) scale(.95)}.modal{position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:3500;display:none;align-items:center;justify-content:center;padding:20px;backdrop-filter:blur(10px)}.modal-card{background:#161b22;width:100%;max-width:400px;border-radius:24px;padding:20px;border:1px solid var(--border);display:flex;flex-direction:column;max-height:85vh;box-shadow:0 20px 60px rgba(0,0,0,.8)}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid var(--border)}.close-btn{background:0 0;border:none;color:#fff;font-size:24px;cursor:pointer}.scroll-content{flex:1;overflow-y:auto;margin-bottom:15px}.audio-player{display:flex;align-items:center;gap:10px;background:linear-gradient(145deg,#1e1e1e,#161616);border:1px solid rgba(255,255,255,.1);padding:8px 12px;border-radius:25px;width:fit-content;margin-top:5px;cursor:pointer;transition:all .2s ease;box-shadow:0 2px 5px rgba(0,0,0,.2)}.audio-player.playing{border-color:var(--primary);background:rgba(0,210,255,.1)}.audio-btn{width:28px;height:28px;border-radius:50%;background:var(--primary);display:grid;place-items:center;color:#000;flex-shrink:0;transition:.2s}.audio-player.playing .audio-btn{background:var(--viby);box-shadow:0 0 10px var(--viby)}.audio-wave{display:flex;align-items:center;gap:3px;height:16px}.bar{width:3px;height:4px;background:#666;border-radius:2px;transition:.2s}.audio-player.playing .bar{background:var(--primary);animation:soundWave .8s infinite ease-in-out alternate}.audio-player.playing .bar:nth-child(1){animation-delay:0s}.audio-player.playing .bar:nth-child(2){animation-delay:.2s}.audio-player.playing .bar:nth-child(3){animation-delay:.4s}.audio-player.playing .bar:nth-child(4){animation-delay:.1s}.audio-text{font-size:11px;font-weight:700;color:#aaa;margin-left:5px}.audio-player.playing .audio-text{color:var(--primary)}@keyframes soundWave{0%{height:4px}100%{height:16px}}.comment-item{display:flex;gap:10px;margin-bottom:15px;align-items:flex-start}.c-avatar{width:34px;height:34px;border-radius:50%;object-fit:cover;cursor:pointer;border:1px solid var(--border)}.c-content{flex:1}.c-bubble{background:#222;padding:10px 14px;border-radius:12px;border:1px solid var(--border);display:inline-block;min-width:150px}.c-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:4px}.c-user{font-weight:700;color:var(--primary);font-size:12px;cursor:pointer}.c-time{font-size:10px;color:var(--muted)}.c-text{font-size:14px;color:#eee;line-height:1.4}.c-actions{display:flex;align-items:center;gap:10px;margin-top:5px;margin-left:5px}.c-like-btn{background:0 0;border:none;color:#666;font-size:11px;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:4px}.c-like-btn.active{color:var(--danger)}.chat-interface{position:fixed;inset:0;background:#000;z-index:3000;display:flex;flex-direction:column}.chat-top{padding:15px;border-bottom:1px solid var(--border);display:flex;align-items:center;gap:15px;background:#111}.chat-exit{background:0 0;border:none;color:var(--danger);display:flex;align-items:center;cursor:pointer}.chat-scroll{flex:1;overflow-y:auto;padding:15px;display:flex;flex-direction:column;gap:10px}.msg-row{display:flex;gap:10px;max-width:85%;align-items:flex-end}.msg-row.me{align-self:flex-end;flex-direction:row-reverse}.msg-img{width:32px;height:32px;border-radius:50%;border:1px solid #333;object-fit:cover}.msg-box{padding:8px 12px;border-radius:12px;background:#1a1a1a;border:1px solid var(--border);min-width:100px;position:relative}.msg-row.me .msg-box{background:rgba(0,210,255,.15);border-color:var(--primary)}.msg-user{font-size:11px;font-weight:700;color:var(--primary);margin-bottom:4px;display:block}.msg-time{font-size:9px;color:rgba(255,255,255,.5);text-align:right;margin-top:4px;display:block}.chat-controls{padding:10px;background:#111;border-top:1px solid var(--border)}.input-row{display:flex;gap:10px;align-items:center}.chat-input{flex:1;background:#000;border:1px solid var(--border);padding:12px 15px;border-radius:25px;color:#fff}.circle-btn{width:42px;height:42px;border-radius:50%;border:1px solid var(--border);background:#222;color:#fff;display:grid;place-items:center;cursor:pointer;flex-shrink:0;transition:.2s}.circle-btn.recording{background:var(--danger);border-color:var(--danger);box-shadow:0 0 15px var(--danger);animation:pulse 1s infinite}.send-btn{width:42px;height:42px;border-radius:50%;background:var(--primary);border:none;display:grid;place-items:center;cursor:pointer;color:#000}@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}.prof-view{text-align:center}.prof-lg{width:100px;height:100px;border-radius:50%;border:3px solid var(--primary);object-fit:cover;margin-bottom:10px}.prof-rank-badge{display:inline-block;padding:6px 14px;border-radius:20px;font-size:12px;font-weight:900;text-transform:uppercase;margin-bottom:10px;color:#000;letter-spacing:1px}.prof-bio{font-size:14px;color:#ccc;margin-bottom:20px;font-style:italic;line-height:1.4;padding:0 15px}.stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:20px}.stat-box{background:#222;padding:15px;border-radius:12px;border:1px solid var(--border)}.info-list{text-align:left;background:#1a1a1a;padding:15px;border-radius:16px;border:1px solid var(--border)}.info-row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px solid #333;font-size:14px}.edit-profile-btn{background:var(--primary);color:#000;border:none;padding:10px 20px;border-radius:10px;font-weight:800;cursor:pointer;margin-top:15px;width:100%;display:none}.form-input{width:100%;background:#000;border:1px solid var(--border);color:#fff;padding:14px;border-radius:12px;margin-bottom:12px}.btn-primary{width:100%;padding:15px;background:var(--primary);border:none;border-radius:12px;font-weight:800;cursor:pointer;color:#000}#bgOptions{display:flex;gap:15px;margin-bottom:15px;overflow-x:auto;padding-bottom:5px;align-items:center}.bg-circle{width:45px;height:45px;border-radius:50%;flex-shrink:0;cursor:pointer;border:2px solid transparent;transition:.2s}.bg-circle.selected{border-color:#fff;transform:scale(1.1)}.upload-tools{display:flex;gap:10px;align-items:center}.tool-btn{width:45px;height:45px;border-radius:50%;background:#222;border:1px solid var(--border);display:grid;place-items:center;color:#fff;cursor:pointer;flex-shrink:0}
:root{--maxW:1100px}
#mainScroll{scrollbar-gutter:stable}
.post-visual{min-height:260px;height:clamp(260px,55vw,420px)}
.post-visual img{width:100%;height:100%;object-fit:cover}
@media (min-width:768px){
  #mainScroll{padding-bottom:140px}
  .topbar,.event-banner,.rooms-layout{max-width:var(--maxW);margin-left:auto;margin-right:auto}
  .topbar{padding:18px 24px}
  .event-banner{padding:0 24px;margin-bottom:22px}
  .event-banner img{height:110px}
  .feed{max-width:var(--maxW);margin:0 auto;padding:0 24px 24px 24px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:22px}
  .post-card{border-radius:22px}
  .post-visual{height:clamp(220px,32vh,420px)}
  .img-caption{font-size:14px;padding:60px 18px 16px}
  .post-header{padding:14px 16px}
  .post-actions{padding:14px 16px}
  .hood-grid{grid-template-columns:repeat(3,1fr);gap:14px}
  .hood-item{padding:22px}
  .dock{gap:45px;padding:12px 42px}
  .modal-card{max-width:520px}
}
@media (min-width:1100px){
  .feed{grid-template-columns:repeat(3,minmax(0,1fr))}
  .hood-grid{grid-template-columns:repeat(4,1fr)}
  .post-visual{height:clamp(220px,28vh,380px)}
  .event-banner img{height:130px}
}
@media (min-width:900px){
  .authPage{flex-direction:row;overflow:hidden;padding-bottom:0}
  .hero{width:55%;height:100vh;padding:18px}
  .hero img{border-radius:32px;height:100%}
  .content{width:45%;padding:60px;justify-content:center}
  .sub-text{max-width:420px}
  .tiktok-link{position:static;margin-top:18px;bottom:auto;left:auto;right:auto;width:fit-content;padding:0;background:transparent;border:none;backdrop-filter:none}
}
</style><script>document.addEventListener("contextmenu",e=>e.preventDefault()),document.onkeydown=function(e){if(123==e.keyCode||e.ctrlKey&&e.shiftKey&&"I"==e.key||e.ctrlKey&&e.shiftKey&&"C"==e.key||e.ctrlKey&&e.shiftKey&&"J"==e.key||e.ctrlKey&&"U"==e.key)return!1};</script></head><body><svg style="display:none"><symbol id="i-home" viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path></symbol><symbol id="i-grid" viewBox="0 0 24 24"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></symbol><symbol id="i-user" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></symbol><symbol id="i-trash" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></symbol><symbol id="i-chat" viewBox="0 0 24 24"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></symbol><symbol id="i-mic" viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></symbol><symbol id="i-send" viewBox="0 0 24 24"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></symbol><symbol id="i-play" viewBox="0 0 24 24"><polygon points="5 3 19 12 5 21 5 3"></polygon></symbol><symbol id="i-pause" viewBox="0 0 24 24"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></symbol><symbol id="i-up" viewBox="0 0 24 24"><path d="M18 15l-6-6-6 6"/></symbol><symbol id="i-down" viewBox="0 0 24 24"><path d="M6 9l6 6 6-6"/></symbol><symbol id="i-camera" viewBox="0 0 24 24"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></symbol><symbol id="i-image" viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></symbol><symbol id="i-heart" viewBox="0 0 24 24"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></symbol><symbol id="i-bolt-filled" viewBox="0 0 24 24"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z" fill="currentColor" stroke="none"/></symbol><symbol id="i-gps" viewBox="0 0 24 24"><path d="M12 2a8 8 0 0 1 8 8c0 5.4-8 14-8 14S4 15.4 4 10a8 8 0 0 1 8-8z"/><circle cx="12" cy="10" r="3"/></symbol><symbol id="i-exit" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></symbol></svg><audio id="globalAudio"></audio><div id="authView" class="authPage"><div class="hero"><img src="https://up6.cc/2026/02/177066115684561.jpg"></div><div class="content"><div class="typing-container"><h1 class="dynamic-title" id="typewriter"></h1><span class="cursor"></span></div><p class="sub-text">Discover trusted zones, real hype, and people who actually show up.</p><button class="google-btn" id="googleBtn"><img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg">Login with Google</button></div><a href="https://www.tiktok.com/@rabathangout?_r=1&_t=ZS-93oNd7MTmxo" class="tiktok-link"><svg style="width:18px;height:18px" fill="currentColor" viewBox="0 0 448 512"><path d="M448 209.91a210.06 210.06 0 0 1-122.77-39.25v178.72A162.55 162.55 0 1 1 185 188.31v89.89a74.62 74.62 0 1 0 52.23 71.18V0h88a121.18 121.18 0 0 0 1.86 22.17A122.18 122.18 0 0 0 381 102.39a121.43 121.43 0 0 0 67 20.14z"/></svg>TikTok</a></div><div id="mainScroll"><div id="app" class="hidden"><div class="topbar"><div class="brand">HypeZone</div><div class="user-badge" onclick="openProfile(session.user.id)"><img id="myAvatar"><span class="vibe-score"><svg style="width:14px;height:14px;color:var(--viby)"><use href="#i-bolt-filled"></use></svg> <span id="myScore">0</span></span></div></div><div id="feedView"><div class="event-banner"><img src="https://i.postimg.cc/jqm5N5y2/360-F-267512924-Gj-Sh-Um-X2d-Ne-Eq2v-RJI59ae4vc-Am-LJ8j-P.jpg"></div><div class="feed" id="feedList"></div></div><div id="roomsView" class="hidden"><div class="rooms-layout" id="citiesWrap"></div></div></div></div><div class="dock-wrapper hidden" id="dockWrap"><div class="dock"><button class="dock-btn active" onclick="switchView('feed',this)"><svg><use href="#i-home"></use></svg> Home</button><button class="fab-main" onclick="openCreate()">＋</button><button class="dock-btn" onclick="switchView('rooms',this)"><svg><use href="#i-grid"></use></svg> Rooms</button></div></div><div id="chatRoom" class="chat-interface hidden"><div class="chat-top"><button class="chat-exit" onclick="stopRoomLive();document.getElementById('chatRoom').classList.add('hidden')"><svg style="width:28px;height:28px"><use href="#i-exit"></use></svg></button><div style="font-weight:800;font-size:18px;color:#fff;margin-left:15px" id="roomNameDisplay">Room</div></div><div class="chat-scroll" id="chatMsgs"></div><div class="chat-controls"><div class="input-row"><input class="chat-input" id="roomInput" placeholder="Message..."><button class="circle-btn" id="roomMic"><svg><use href="#i-mic"></use></svg></button><button class="circle-btn send-btn" onclick="sendRoomMsg()"><svg><use href="#i-send"></use></svg></button></div></div></div><div id="commentsModal" class="modal"><div class="modal-card"><div class="modal-header"><h3>Comments</h3><button class="close-btn" onclick="closeModal('commentsModal')">✕</button></div><div class="scroll-content" id="postCommentsList"></div><div class="input-row"><input class="chat-input" id="commentInput" placeholder="Add comment..."><button class="circle-btn" id="commentMicBtn"><svg><use href="#i-mic"></use></svg></button><button class="circle-btn send-btn" onclick="sendPostComment()"><svg><use href="#i-send"></use></svg></button></div></div></div><div id="profileModal" class="modal"><div class="modal-card"><div class="modal-header"><h3>Profile</h3><button class="close-btn" onclick="closeModal('profileModal')">✕</button></div><div class="prof-view"><img id="vpImg" class="prof-lg"><h2 id="vpName">Name</h2><div id="vpRankBadge" class="prof-rank-badge">ROOKIE</div><div class="prof-bio" id="vpBio"></div><div class="stat-grid"><div class="stat-box"><div style="font-size:20px;font-weight:800;color:var(--viby)" id="vpScore">0</div><div style="font-size:10px;color:#888">SCORE</div></div><div class="stat-box"><div style="font-size:20px;font-weight:800" id="vpPosts">0</div><div style="font-size:10px;color:#888">POSTS</div></div></div><div class="info-list"><div class="info-row"><span>City</span><span id="vpCity">-</span></div><div class="info-row"><span>Neighborhood</span><span id="vpHood">-</span></div><div class="info-row"><span>Age</span><span id="vpAge">-</span></div><div class="info-row"><span>Gender</span><span id="vpGender">-</span></div><div class="info-row"><span>Interests</span><span id="vpInterests">-</span></div></div><button id="editProfileBtn" class="edit-profile-btn" onclick="openEditProfile()">Edit Profile</button></div></div></div><div id="setupModal" class="modal" style="z-index:3000"><div class="modal-card"><div class="modal-header"><h2 style="color:#fff" id="setupTitle">Identify Yourself</h2><button class="close-btn" onclick="document.getElementById('setupModal').style.display='none'">✕</button></div><div class="scroll-content"><div style="text-align:center;margin-bottom:15px"><label class="bg-circle" style="display:inline-block;width:80px;height:80px;background:#222;border:2px dashed #555;overflow:hidden"><img id="setupAvatarImg" style="width:100%;height:100%;object-fit:cover;display:none"><input type="file" id="setupFile" hidden onchange="previewSetupImg(this)"></label></div><input class="form-input" id="setupUser" placeholder="Username (Fixed)" disabled style="color:#888"><input class="form-input" id="setupFull" placeholder="Display Name"><div style="display:flex;gap:10px"><input class="form-input" type="number" id="setupAge" placeholder="Age"><select class="form-input" id="setupGender"><option>Male</option><option>Female</option></select></div><select class="form-input" id="setupHood"></select><input class="form-input" id="setupInterests" placeholder="Interests"><textarea class="form-input" id="setupBio" placeholder="Bio..."></textarea><button class="btn-primary" onclick="saveProfileChanges()">Save Changes</button></div></div></div><div id="createModal" class="modal"><div class="modal-card"><div class="modal-header"><h3>New Hype</h3><button class="close-btn" onclick="document.getElementById('createModal').style.display='none'">✕</button></div><div id="bgOptions"><div class="upload-tools"><label class="tool-btn" onclick="document.getElementById('postFile').click()"><svg><use href="#i-image"></use></svg></label><label class="tool-btn" onclick="document.getElementById('postFile').click()"><svg><use href="#i-camera"></use></svg></label></div></div><input type="file" id="postFile" hidden onchange="previewFile()"><img id="imgPreview" style="width:100%;display:none;margin-bottom:10px;border-radius:10px"><textarea class="form-input" id="postCap" placeholder="Caption..."></textarea><button class="btn-primary" onclick="submitPost()">Post</button></div></div><script>const sb=supabase.createClient("https://tujdnvnrizgqroaozsqp.supabase.co","sb_publishable_WyigevxmzR2gLtbog2Ztfg_8pdmSwop");let session,currentBg,currentPostId,currentRoomKey=null,currentRoomLabel=null,recorder,chunks=[],roomSub,currentPlayingBtn=null,myProfile={},isEditing=!1,currentEditingUser=null,roomPollTimer=null,lastRoomCreatedAt=null,seenRoomMsgIds=new Set,roomProfileCache={};const globalAudio=document.getElementById("globalAudio"),cities={rabat:{name:"Rabat",hoods:["Agdal","Hassan","Hay Riad","Ocean","Medina","Souissi","Yacoub Al Mansour","Akkari","Kammra","Temara","Skhirat"]},sale:{name:"Sale",hoods:["Diar","Hay Chmaaou","Opera","Wad Adahab","Bab Lmrissa","Tabriquet","Sala Al Jadida","Hay Salam","Bettana","Sidi Moussa"]},casablanca:{name:"Casablanca",hoods:["Maarif","Anfa","Ain Diab","Gauthier","Bourgogne","Racine","Sidi Maarouf","Hay Hassani","Ain Sebaa","Sidi Bernoussi","Oulfa","California","Beausejour","Derb Sultan","Mers Sultan","Belvedere","Hay Mohammadi","Sbata","Ben M'Sick","Lissasfa","Zenata"]},marrakech:{name:"Marrakech",hoods:["Gueliz","Hivernage","Medina","Sidi Ghanem","Agdal","Targa","Daoudiate","Semlalia","Bab Doukkala","Bab Aylan","Mellah","Palmeraie"]},fes:{name:"Fes",hoods:["Fes El Bali","Fes El Jdid","Ville Nouvelle","Narjiss","Agdal","Zouagha","Sidi Boujida","Bensouda","Saiss"]},tangier:{name:"Tangier",hoods:["Malabata","Iberia","Marshan","Medina","California","Boukhalef","Mghogha","Bni Makada","Achakar"]},agadir:{name:"Agadir",hoods:["Talborjt","Founty","Agadir Bay","Anza","Dakhla","Bensergao","Tilila","Hay Mohammadi","Ait Melloul","Inezgane"]},meknes:{name:"Meknes",hoods:["Hamria","Medina","Borj Moulay Omar","Marjane","Wislane","Sidi Bouzekri","Toulal","Zitoune"]},oujda:{name:"Oujda",hoods:["Hay Al Qods","Hay Salam","Sidi Yahya","Centre Ville","Lazaret","Al Andalous","Hay Najd"]},kenitra:{name:"Kenitra",hoods:["Maamora","Bir Rami","Saknia","Centre Ville","Val Fleuri","Oulad Oujih","Mimosas"]},tetouan:{name:"Tetouan",hoods:["Medina","Ensanche","Sania Rmel","Bouanan","Touilaa","Martil"]},eljadida:{name:"El Jadida",hoods:["Centre Ville","Sidi Bouzid","Hay Salam","Cite Portugaise","Najd","Azemmour"]},safi:{name:"Safi",hoods:["Ville Nouvelle","Medina","Sidi Bouzid","Jorf","Errahma","Hay Salam"]},mohammedia:{name:"Mohammedia",hoods:["Centre Ville","Mansouria","Fadila","Hay Salam","Al Wafa","Kasbah"]},nador:{name:"Nador",hoods:["Centre Ville","Selouane","Beni Ensar","Al Aaroui","Bouarg"]},benimellal:{name:"Beni Mellal",hoods:["Centre Ville","Hay Salam","Aghbala Road","Kasbah Ras El Ain","Ouled Yaich"]},khouribga:{name:"Khouribga",hoods:["Centre Ville","Hay Salam","OCP","Fqih Ben Salah Road"]},taza:{name:"Taza",hoods:["Ville Nouvelle","Medina","Bab El Qarmoud","Bab El Gharbi"]},essaouira:{name:"Essaouira",hoods:["Medina","New Town","Diabat","Borj","Mellah"]},laayoune:{name:"Laayoune",hoods:["Centre Ville","Maatallah","Al Massira","Hay Salam","El Wifaq"]},dakhla:{name:"Dakhla",hoods:["City Center","Al Wahda","Al Matar","Al Qassam"]}};const cityOrder=["rabat","sale","casablanca","marrakech","fes","tangier","agadir","meknes","oujda","kenitra","tetouan","eljadida","safi","mohammedia","nador","benimellal","khouribga","taza","essaouira","laayoune","dakhla"],gradients=["linear-gradient(45deg,#ff9a9e,#fecfef)","linear-gradient(120deg,#84fab0,#8fd3f4)","linear-gradient(to top,#30cfd0,#330867)","linear-gradient(to right,#434343,black)","linear-gradient(to top,#fcc5e4,#020f75)"],phrases=["This isn't an app. It's a zone.","Find hype where people show up.","Discover Morocco's hottest rooms.","Real hype, real people.","Join the HypeZone crew."];let phraseIdx=0,charIdx=0,isDeleting=!1;function type(){const e=phrases[phraseIdx],t=document.getElementById("typewriter");isDeleting?(t.textContent=e.substring(0,charIdx-1),charIdx--):(t.textContent=e.substring(0,charIdx+1),charIdx++);let n=isDeleting?50:100;isDeleting||charIdx!==e.length?isDeleting&&0===charIdx&&(isDeleting=!1,phraseIdx=(phraseIdx+1)%phrases.length,n=500):(n=2e3,isDeleting=!0),setTimeout(type,n)}function roomKey(e,t){return e+"|"+t}function parseHoodValue(e){const t=(e||"").split("|");return{cityKey:t[0]||"rabat",hood:t[1]||"Agdal"}}function cityInHoodLabel(e,t){const n=cities[e]?cities[e].name:"Rabat";return n+" in "+t}async function init(){type();renderCities();renderGradients();renderSetupHoods();const{data:e}=await sb.auth.getSession();e.session&&(session=e.session,document.getElementById("authView").style.display="none",document.getElementById("app").classList.remove("hidden"),document.getElementById("dockWrap").classList.remove("hidden"),await checkProfile()),sb.auth.onAuthStateChange(e=>{"SIGNED_OUT"===e&&location.reload()})}function timeAgo(e){const t=Math.floor((new Date-new Date(e))/1e3);if(t<60)return"Just now";const n=Math.floor(t/60);if(n<60)return n+"m";const o=Math.floor(n/60);return o<24?o+"h":Math.floor(o/24)+"d"}function formatChatTime(e){return new Date(e).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function getRank(e){return e<50?{name:"ROOKIE",cls:"rank-rookie"}:e<1e3?{name:"GOLD",cls:"rank-gold"}:{name:"LEGEND",cls:"rank-legend"}}async function checkProfile(){const{data:e}=await sb.from("profiles").select("*").eq("id",session.user.id).single();e&&e.username?(myProfile=e,document.getElementById("setupModal").style.display="none",document.getElementById("myAvatar").src=e.avatar_url,document.getElementById("myScore").innerText=e.vibe_score||0,loadFeed()):(isEditing=!1,document.getElementById("setupModal").style.display="flex",document.getElementById("setupUser").disabled=!1)}async function loadFeed(){const e=document.getElementById("feedList");e.innerHTML="<div style='text-align:center;color:#666'>Loading...</div>";const{data:t}=await sb.from("posts").select("*, profiles(*)").order("created_at",{ascending:!1});e.innerHTML="",t&&t.forEach(t=>{const n=t.profiles,o=getRank(n.vibe_score||0),r=session.user.id===n.id,i=t.background_style?`<div class="post-visual" style="background:${t.background_style}"><div class="bg-text">${escapeHtml(t.caption)}</div></div>`:`<div class="post-visual"><img src="${t.image_url}"><div class="img-caption">${escapeHtml(t.caption)}</div></div>`,a=(n.city||"Rabat")+" in "+(n.neighborhood||"");e.innerHTML+=`<div class="post-card"><div class="post-header"><div class="post-user-info"><img class="p-avatar" src="${n.avatar_url}" onclick="openProfile('${n.id}')"><div onclick="openProfile('${n.id}')"><div class="p-name">${n.username} <span class="rank-tag ${o.cls}">${o.name}</span></div><div class="p-loc">${a} • ${timeAgo(t.created_at)}</div></div></div>${r?`<button class="delete-btn" onclick="deletePost('${t.id}')"><svg><use href="#i-trash"></use></svg></button>`:""}</div>${i}<div class="post-actions"><div class="vote-box"><button class="vote-btn up" onclick="vote('${t.id}', 1)"><svg><use href="#i-up"></use></svg></button><span class="vote-val">${n.vibe_score||0}</span><button class="vote-btn down" onclick="vote('${t.id}', -1)"><svg><use href="#i-down"></use></svg></button></div><button class="action-btn" onclick="openComments('${t.id}')"><svg style="width:16px"><use href="#i-chat"></use></svg> Comments</button></div></div>`})}function playAudio(e,t){if(currentPlayingBtn===t&&!globalAudio.paused)return globalAudio.pause(),void resetPlayerUI(t);currentPlayingBtn&&currentPlayingBtn!==t&&resetPlayerUI(currentPlayingBtn),currentPlayingBtn=t,globalAudio.src=e,globalAudio.play(),t.classList.add("playing"),t.querySelector(".audio-btn").innerHTML='<svg style="width:14px;height:14px;fill:#000;stroke:none"><use href="#i-pause"></use></svg>',t.querySelector(".audio-text").innerText="Playing..."}function resetPlayerUI(e){e&&(e.classList.remove("playing"),e.querySelector(".audio-btn").innerHTML='<svg style="width:14px;height:14px;fill:#000;stroke:none"><use href="#i-play"></use></svg>',e.querySelector(".audio-text").innerText="Play Voice")}async function openComments(e){currentPostId=e,document.getElementById("commentsModal").style.display="flex",loadPostComments()}async function loadPostComments(){const e=document.getElementById("postCommentsList");e.innerHTML="Loading...";const{data:t}=await sb.from("comments").select("*, profiles(*)").eq("post_id",currentPostId).order("created_at"),{data:n}=await sb.from("comment_votes").select("comment_id").eq("user_id",session.user.id),o=new Set(n?n.map(e=>e.comment_id):[]);e.innerHTML="",t&&t.forEach(t=>{const n=o.has(t.id),r=t.audio_url?`<div class="audio-player" onclick="playAudio('${t.audio_url}', this)"><div class="audio-btn"><svg style="width:14px;height:14px;fill:#000;stroke:none"><use href="#i-play"></use></svg></div><div class="audio-wave"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div><span class="audio-text">Voice</span></div>`:`<div class="c-text">${escapeHtml(t.text_content)}</div>`;e.innerHTML+=`<div class="comment-item"><img class="c-avatar" src="${t.profiles.avatar_url}" onclick="openProfile('${t.profiles.id}')"><div class="c-content"><div class="c-bubble"><div class="c-header"><span class="c-user" onclick="openProfile('${t.profiles.id}')">${t.profiles.username}</span><span class="c-time">${timeAgo(t.created_at)}</span></div>${r}</div><div class="c-actions"><button class="c-like-btn ${n?"active":""}" onclick="voteComment('${t.id}', this)"><svg style="width:14px"><use href="#i-heart"></use></svg> Like</button></div></div></div>`})}async function voteComment(e,t){const n=t.classList.contains("active");t.classList.toggle("active"),n?await sb.from("comment_votes").delete().eq("user_id",session.user.id).eq("comment_id",e):await sb.from("comment_votes").insert({user_id:session.user.id,comment_id:e,vote_type:1})}async function startRecording(e,t){if(!recorder||"inactive"===recorder.state)try{const n=await navigator.mediaDevices.getUserMedia({audio:!0});recorder=new MediaRecorder(n),chunks=[],recorder.ondataavailable=e=>chunks.push(e.data),recorder.onstop=async()=>{const e=new Blob(chunks,{type:"audio/webm"}),n=`aud-${Date.now()}.webm`;await sb.storage.from("audio_comments").upload(n,e);const{data:o}=sb.storage.from("audio_comments").getPublicUrl(n);t(o.publicUrl)},recorder.start(),e.classList.add("recording")}catch(e){alert("Mic Error: Use HTTPS")}else recorder.stop(),e.classList.remove("recording")}async function sendPostComment(){const e=document.getElementById("commentInput").value;e&&(await sb.from("comments").insert({post_id:currentPostId,user_id:session.user.id,text_content:e}),document.getElementById("commentInput").value="",loadPostComments())}async function openProfile(e){const t=document.getElementById("profileModal");t.style.display="flex";const{data:n}=await sb.from("profiles").select("*").eq("id",e).single();currentEditingUser=n;const{count:o}=await sb.from("posts").select("*",{count:"exact",head:!0}).eq("user_id",e),r=getRank(n.vibe_score||0);document.getElementById("vpImg").src=n.avatar_url,document.getElementById("vpName").innerText=n.username,document.getElementById("vpRankBadge").innerText=r.name,document.getElementById("vpRankBadge").className=`prof-rank-badge ${r.cls}`,document.getElementById("vpBio").innerText=n.bio||"No bio yet.",document.getElementById("vpScore").innerText=n.vibe_score||0,document.getElementById("vpPosts").innerText=o||0,document.getElementById("vpCity").innerText=n.city||"-",document.getElementById("vpHood").innerText=n.neighborhood||"-",document.getElementById("vpAge").innerText=n.age||"-",document.getElementById("vpGender").innerText=n.gender||"-",document.getElementById("vpInterests").innerText=n.interests||"-",document.getElementById("editProfileBtn").style.display=session.user.id===e?"block":"none"}function openEditProfile(){isEditing=!0;const e=currentEditingUser;document.getElementById("profileModal").style.display="none",document.getElementById("setupModal").style.display="flex",document.getElementById("setupTitle").innerText="Edit Profile",document.getElementById("setupAvatarImg").src=e.avatar_url,document.getElementById("setupAvatarImg").style.display="block",document.getElementById("setupUser").value=e.username,document.getElementById("setupUser").disabled=!0,document.getElementById("setupFull").value=e.full_name||"",document.getElementById("setupAge").value=e.age||"",document.getElementById("setupGender").value=e.gender||"Male";const t=(e.city||"rabat").toLowerCase(),n=e.neighborhood||"Agdal";document.getElementById("setupHood").value=roomKey(t,n),document.getElementById("setupInterests").value=e.interests||"",document.getElementById("setupBio").value=e.bio||""}function previewSetupImg(e){e.files&&e.files[0]&&(document.getElementById("setupAvatarImg").src=URL.createObjectURL(e.files[0]),document.getElementById("setupAvatarImg").style.display="block")}function renderSetupHoods(){const e=document.getElementById("setupHood");if(!e)return;e.innerHTML="";cityOrder.forEach(t=>{const n=cities[t];if(!n)return;const o=document.createElement("optgroup");o.label=n.name,n.hoods.forEach(n=>{const r=document.createElement("option");r.value=roomKey(t,n),r.textContent=n,o.appendChild(r)}),e.appendChild(o)});e.value=roomKey("rabat","Agdal")}async function saveProfileChanges(){const e=document.querySelector("#setupModal .btn-primary");e.textContent="Saving...",e.disabled=!0;const t=document.getElementById("setupFile").files[0];let n=myProfile.avatar_url;if(t){if(n&&!n.includes("default")){const e=n.split("/").pop();await sb.storage.from("avatars").remove([e])}const e=`${session.user.id}-${Date.now()}`;await sb.storage.from("avatars").upload(e,t);const{data:o}=sb.storage.from("avatars").getPublicUrl(e);n=o.publicUrl}const o=parseHoodValue(document.getElementById("setupHood").value),r=cities[o.cityKey]?cities[o.cityKey].name:"Rabat",i={id:session.user.id,username:document.getElementById("setupUser").value,full_name:document.getElementById("setupFull").value,age:document.getElementById("setupAge").value,gender:document.getElementById("setupGender").value,city:r,neighborhood:o.hood,interests:document.getElementById("setupInterests").value,bio:document.getElementById("setupBio").value,avatar_url:n};await sb.from("profiles").upsert(i),location.reload()}function closeModal(e){document.getElementById(e).style.display="none"}function switchView(e,t){document.querySelectorAll(".dock-btn").forEach(e=>e.classList.remove("active")),t.classList.add("active"),document.getElementById("feedView").classList.add("hidden"),document.getElementById("roomsView").classList.add("hidden"),document.getElementById(e+"View").classList.remove("hidden")}function renderCities(){const e=document.getElementById("citiesWrap");if(!e)return;e.innerHTML="";cityOrder.forEach(t=>{const n=cities[t];if(!n)return;const o=document.createElement("div");o.className="city-header",o.innerHTML=`<svg class="city-icon"><use href="#i-gps"></use></svg><span class="city-title">${n.name.toUpperCase()}</span>`;const r=document.createElement("div");r.className="hood-grid",r.id=t+"Grid",n.hoods.forEach(e=>{r.innerHTML+=`<div class="hood-item" onclick="openRoom('${t}','${e}')"><div class="online-dot"></div><div class="hood-name">${e}</div></div>`}),e.appendChild(o),e.appendChild(r)})}function stopRoomLive(){roomSub&&sb.removeChannel(roomSub),roomSub=null,roomPollTimer&&(clearInterval(roomPollTimer),roomPollTimer=null)}async function openRoom(e,t){const n=cities[e]?cities[e].name:"Rabat";currentRoomKey=roomKey(e,t),currentRoomLabel=cityInHoodLabel(e,t),document.getElementById("chatRoom").classList.remove("hidden"),document.getElementById("roomNameDisplay").innerText=currentRoomLabel,stopRoomLive(),seenRoomMsgIds=new Set,lastRoomCreatedAt=null,roomProfileCache={},await loadRoomMsgs();const o=`room_name=eq.${encodeURIComponent(currentRoomKey)}`;roomSub=sb.channel("room-"+currentRoomKey).on("postgres_changes",{event:"INSERT",schema:"public",table:"room_chats",filter:o},async e=>{const t=e.new;if(!t||seenRoomMsgIds.has(t.id))return;seenRoomMsgIds.add(t.id),lastRoomCreatedAt=t.created_at||lastRoomCreatedAt;let n=roomProfileCache[t.user_id];n||(n=(await sb.from("profiles").select("id,username,avatar_url").eq("id",t.user_id).single()).data||{username:"User",avatar_url:""},roomProfileCache[t.user_id]=n),renderOneMessage(t,n)}).subscribe();roomPollTimer=setInterval(async()=>{if(!currentRoomKey)return;const e=lastRoomCreatedAt||new Date(0).toISOString();const{data:t}=await sb.from("room_chats").select("*").eq("room_name",currentRoomKey).gt("created_at",e).order("created_at",{ascending:!0});if(!t||!t.length)return;const n=t.filter(e=>!seenRoomMsgIds.has(e.id));if(!n.length)return;const o=[...new Set(n.map(e=>e.user_id).filter(Boolean))],{data:r}=o.length?await sb.from("profiles").select("id,username,avatar_url").in("id",o):{data:[]},i={};r&&r.forEach(e=>i[e.id]=e),n.forEach(e=>{seenRoomMsgIds.add(e.id),roomProfileCache[e.user_id]=roomProfileCache[e.user_id]||i[e.user_id]||{username:"User",avatar_url:""};const t=roomProfileCache[e.user_id];renderOneMessage(e,t),lastRoomCreatedAt=e.created_at||lastRoomCreatedAt})},900)}async function loadRoomMsgs(){const e=document.getElementById("chatMsgs");e.innerHTML="Loading...";const{data:t,error:n}=await sb.from("room_chats").select("*").eq("room_name",currentRoomKey).order("created_at",{ascending:!0});if(e.innerHTML="",n||!t)return;const o=[...new Set(t.map(e=>e.user_id))],{data:r}=await sb.from("profiles").select("id, username, avatar_url").in("id",o),i={};r&&r.forEach(e=>{i[e.id]=e,roomProfileCache[e.id]=e}),t.forEach(e=>{e.id&&seenRoomMsgIds.add(e.id),renderOneMessage(e,i[e.user_id])});const a=t[t.length-1];a&&(lastRoomCreatedAt=a.created_at),e.scrollTop=e.scrollHeight}function renderOneMessage(e,t){const n=document.getElementById("chatMsgs"),o=e.user_id===session.user.id,r=t||{username:"User",avatar_url:""},i=e.audio_url?`<div class="audio-player" onclick="playAudio('${e.audio_url}', this)"><div class="audio-btn"><svg style="width:14px;height:14px;fill:#000;stroke:none"><use href="#i-play"></use></svg></div><div class="audio-wave"><div class="bar"></div><div class="bar"></div><div class="bar"></div><div class="bar"></div></div><span class="audio-text">Voice</span></div>`:`<div class="msg-content">${escapeHtml(e.content)}</div>`;n.insertAdjacentHTML("beforeend",`<div class="msg-row ${o?"me":""}"> ${o?"":`<img class="msg-img" src="${r.avatar_url}" onclick="openProfile('${e.user_id}')">`} <div class="msg-box"> ${o?"":`<span class="msg-user">${r.username}</span>`} ${i} <span class="msg-time">${formatChatTime(e.created_at)}</span> </div> </div>`),n.scrollTop=n.scrollHeight}async function sendRoomMsg(){const e=document.getElementById("roomInput").value.trim();if(!e||!currentRoomKey)return;document.getElementById("roomInput").value="";const{data:t}=await sb.from("room_chats").insert({room_name:currentRoomKey,user_id:session.user.id,content:e}).select("*").single();t&&(t.id&&seenRoomMsgIds.add(t.id),lastRoomCreatedAt=t.created_at||lastRoomCreatedAt,renderOneMessage(t,myProfile))}function renderGradients(){const e=document.getElementById("bgOptions");gradients.forEach(t=>e.innerHTML+=`<div class="bg-circle" style="background:${t}" onclick="setBg('${t}', this)"></div>`)}function setBg(e,t){currentBg=e,document.querySelectorAll(".bg-circle").forEach(e=>e.classList.remove("selected")),t&&t.classList.add("selected")}function previewFile(){document.getElementById("imgPreview").src=URL.createObjectURL(document.getElementById("postFile").files[0]),document.getElementById("imgPreview").style.display="block"}function openCreate(){document.getElementById("createModal").style.display="flex"}async function submitPost(){const e=document.getElementById("postCap").value,t=document.getElementById("postFile").files[0];let n=null;if(!currentBg&&!t)return alert("Select background or image");if(t&&!currentBg){const e=`${Date.now()}`;await sb.storage.from("post_images").upload(e,t),n=sb.storage.from("post_images").getPublicUrl(e).data.publicUrl}await sb.from("posts").insert({user_id:session.user.id,caption:e,image_url:n,background_style:currentBg}),document.getElementById("createModal").style.display="none",loadFeed()}async function deletePost(e){confirm("Delete this vibe?")&&(await sb.from("posts").delete().eq("id",e),loadFeed())}async function vote(e,t){const{data:n}=await sb.from("post_votes").select("*").eq("user_id",session.user.id).eq("post_id",e).maybeSingle();n?n.vote_type===t?await sb.from("post_votes").delete().eq("id",n.id):await sb.from("post_votes").update({vote_type:t}).eq("id",n.id):await sb.from("post_votes").insert({user_id:session.user.id,post_id:e,vote_type:t}),loadFeed()}function escapeHtml(e){return e?e.replace(/&/g,"&amp;").replace(/</g,"&lt;"):""}document.getElementById("googleBtn").onclick=async()=>await sb.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.href}}),document.getElementById("commentMicBtn").onclick=function(){startRecording(this,async e=>{await sb.from("comments").insert({post_id:currentPostId,user_id:session.user.id,audio_url:e}),loadPostComments()})},document.getElementById("roomMic").onclick=function(){startRecording(this,async e=>{if(!currentRoomKey)return;const{data:t}=await sb.from("room_chats").insert({room_name:currentRoomKey,user_id:session.user.id,audio_url:e}).select("*").single();t&&(t.id&&seenRoomMsgIds.add(t.id),lastRoomCreatedAt=t.created_at||lastRoomCreatedAt,renderOneMessage(t,myProfile))})},init();</script></body></html>
